= VÃ©rification en conditions rÃ©elles
:imagesdir: assets/default/images
image::mi-check.png[]

== ğŸ•µï¸ Surveillance passive

[source,bash]
----
cilium status
cilium clustermesh status
----

image::terminal-cilium-status.gif[width=90%]

[NOTE.speaker]
====
* trop verbeux
* ğŸš« pas une **preuve de connectivitÃ©**
====

== ğŸ§¬ Analyse poussÃ©e

[source,bash]
----
cilium status -o json
cilium clustermesh status -o json
----

[NOTE.speaker]
====
* ğŸ“Š DonnÃ©es plus exploitables
* ğŸ¤– IdÃ©al pour un tableau de bord
* ğŸš« Toujours pas une **preuve de connectivitÃ©**
====

== Test de connectivitÃ©

[source,bash]
----
cilium connectivity test --context cluster1 --multi-cluster cluster2
----

image::clustermesh-test.png[width=80%]

[NOTE.speaker]
====
* ğŸ” Lance une **batterie de tests**
* â±ï¸ **DurÃ©e moyenne : ~5 minutes**
* ğŸ§ª Parfait pour un **diagnostic entre deux clusters**

* Le test ne vÃ©rifie que **1 âœ 2**
  * Pas de retour automatique **2 âœ 1**
* Pour 511 clusters, le nombre de tests possibles :
  => **130â€¯305** connexions Ã  tester si on veut du **full mesh bidirectionnel**
====

== DÃ©veloppement dâ€™un outil de test

* Modifier la cilium cli :

[source,bash]
----
cilium connectivity test --context cluster1 --multi-cluster cluster[2-511]
----

* Utiliser **Terratest**

== Terratest

image::clustermesh-terratest.png[width=80%]

[NOTE.speaker]
====
ğŸ› ï¸ Projet disponible ici :

* ğŸ‘‰ https://github.com/littlejo/check-cilium-clustermesh
* âœ… 5 tests diffÃ©rents
====
